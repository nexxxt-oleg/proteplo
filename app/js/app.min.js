document.addEventListener("DOMContentLoaded", () => {
    const widthScreen = window.innerWidth || document.documentElement.clientWidth ||
        document.body.clientWidth;

    if (document.getElementById('homeSlider1')) {
        new Swiper('#homeSlider1', {
            spaceBetween: 30,
            loop: true,
            pagination: {
                el: '#homeSlider1 .home-sliders__pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '#homeNext',
                prevEl: '#homePrev',
            },
        });
    }
    if (document.getElementById('homeSlider2')) {
        new Swiper('#homeSlider2', {
            spaceBetween: 30,
            loop: true,
            pagination: {
                el: '#homeSlider2 .home-sliders__pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '#homeNext2',
                prevEl: '#homePrev2',
            },
        });
    }
    if (document.getElementById('newsSlider')) {
        const sliderBrands = new Swiper('#newsSlider', {
            spaceBetween: 30,
            slidesPerView: 3,
            slidesPerGroup: 1,
            navigation: {
                nextEl: '#newsSliderNext',
                prevEl: '#newsSliderPrev',
            },

            breakpoints: {
                300: {
                    slidesPerView: 1,
                    spaceBetween: 16
                },
                600: {
                    slidesPerView: 2,
                    spaceBetween: 20
                },
                991: {
                    slidesPerView: 3,
                    spaceBetween: 20
                },
                1200: {
                    slidesPerView: 3,
                    spaceBetween: 30
                },
            },

        });
    }

    if (document.getElementById('sliderCol3')) {
        const sliderCol3 = new Swiper('#sliderCol3', {
            spaceBetween: 30,
            slidesPerView: 3,
            slidesPerGroup: 1,
            navigation: {
                nextEl: '#next2',
                prevEl: '#prev2',
            },

            breakpoints: {
                300: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: '#scroll2',
                        draggable: true,
                    },
                },
                768: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: '#scroll2',
                        draggable: true,
                    },
                },
                991: {
                    slidesPerView: 3,
                    spaceBetween: 20
                },
                1200: {
                    slidesPerView: 3,
                    spaceBetween: 30
                },
            },

        });
    }

    let sliderProduct = document.querySelectorAll(".slider-product");

    sliderProduct.forEach(function (sliderItem) {
        let nextBtn = '#' + sliderItem.dataset.next;
        let prevBtn = '#' + sliderItem.dataset.prev;
        let scroll = '#' + sliderItem.dataset.scroll;

        new Swiper(sliderItem, {
            spaceBetween: 30,
            slidesPerView: 4,
            slidesPerGroup: 1,
            navigation: {
                nextEl: nextBtn,
                prevEl: prevBtn,
            },

            breakpoints: {
                300: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: scroll,
                        draggable: true,
                    },
                },
                768: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: scroll,
                        draggable: true,
                    },
                },
                800: {
                    slidesPerView: 2,
                    spaceBetween: 20
                },
                991: {
                    slidesPerView: 3,
                    spaceBetween: 20
                },
                1200: {
                    slidesPerView: 4,
                    spaceBetween: 30
                },
            },

        });
    });

    if (document.getElementById('sliderBrand')) {
        new Swiper("#sliderBrand", {
            slidesPerView: 6,
            grid: {
                rows: 2,
            },
            spaceBetween: 30,
            lazy: true,
            navigation: {
                nextEl: '#sliderBrandNext',
                prevEl: '#sliderBrandPrev',
            },
            breakpoints: {
                300: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: "#sliderBrandScroll",
                        draggable: true,
                    },
                },
                768: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: "#sliderBrandScroll",
                        draggable: true,
                    },
                },
                800: {
                    slidesPerView: 4,
                    spaceBetween: 20
                },
                991: {
                    slidesPerView: 5,
                    spaceBetween: 20
                },
                1200: {
                    slidesPerView: 6,
                    spaceBetween: 30
                },
            },
        });
    }

    if (document.getElementById('sliderBrandLine')) {
        new Swiper("#sliderBrandLine", {
            slidesPerView: 6,
            spaceBetween: 30,
            lazy: true,
            navigation: {
                nextEl: '#sliderBrandLineNext',
                prevEl: '#sliderBrandLinePrev',
            },
            breakpoints: {
                300: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: "#sliderBrandLineScroll",
                        draggable: true,
                    },
                },
                768: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: "#sliderBrandLineScroll",
                        draggable: true,
                    },
                },
                800: {
                    slidesPerView: 4,
                    spaceBetween: 20
                },
                991: {
                    slidesPerView: 5,
                    spaceBetween: 20
                },
                1200: {
                    slidesPerView: 6,
                    spaceBetween: 30
                },
            },
        });
    }

    if (document.getElementById('sliderActiveFilter')) {
        new Swiper("#sliderActiveFilter", {
            slidesPerView: 'auto',
            spaceBetween: 10,
        });
    }

    if (document.getElementById('sliderPopularCat')) {
        if (widthScreen > 768) {
            new Readmore('#sliderPopularCat', {
                collapsedHeight: 46,
                moreLink: '<div class="seo-text__footer"><a href="" class="btn-link">' +
                    'Показать еще <svg width="12" height="6" class="ml-5">\n' +
                    '                    <use xlink:href="#svg-bottom"></use>\n' +
                    '                </svg></a></div>',
                lessLink: '<div class="seo-text__footer"><a href="" class="btn-link">' +
                    'Скрыть <svg width="12" height="6" class="ml-5">\n' +
                    '                    <use xlink:href="#svg-up"></use>\n' +
                    '                </svg></a></div>',
                afterToggle: function (trigger, element, expanded) {
                    if (expanded) {
                        document.getElementById('popularCat').classList.add('open_list');
                    } else {
                        document.getElementById('popularCat').classList.remove('open_list');
                    }
                }
            });
        } else {
            new Swiper("#sliderPopularCat", {
                slidesPerView: 'auto',
                spaceBetween: 10,
            });
        }

    }


    if (document.getElementById('sliderRev')) {
        new Swiper("#sliderRev", {
            slidesPerView: 4,
            spaceBetween: 30,

            breakpoints: {
                300: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: "#sliderRevScroll",
                        draggable: true,
                    },
                },
                768: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: "#sliderRevScroll",
                        draggable: true,
                    },
                },
                800: {
                    slidesPerView: 4,
                    spaceBetween: 16
                },
                991: {
                    slidesPerView: 4,
                    spaceBetween: 16
                },
                1200: {
                    slidesPerView: 4,
                    spaceBetween: 30
                },
            },
        });
    }
    if (document.getElementById('sliderNews')) {
        new Swiper("#sliderNews", {
            slidesPerView: 3,
            spaceBetween: 30,
            lazy: true,
            navigation: {
                nextEl: '#sliderNewsNext',
                prevEl: '#sliderNewsPrev',
            },
            breakpoints: {
                300: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: "#sliderNewsScroll",
                        draggable: true,
                    },
                },
                768: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: "#sliderNewsScroll",
                        draggable: true,
                    },
                },
                800: {
                    slidesPerView: 2,
                    spaceBetween: 15
                },
                991: {
                    slidesPerView: 2,
                    spaceBetween: 30
                },
                1200: {
                    slidesPerView: 3,
                    spaceBetween: 30
                },
            },
        });
    }

    if (document.getElementById('analogSlider')) {
        new Swiper("#analogSlider", {
            slidesPerView: 3,
            spaceBetween: 30,
            lazy: true,
            navigation: {
                nextEl: '#analogSliderNext',
                prevEl: '#analogSliderPrev',
            },
            breakpoints: {
                300: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: "#analogSliderScroll",
                        draggable: true,
                    },
                },
                768: {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    scrollbar: {
                        el: "#sliderNewsScroll",
                        draggable: true,
                    },
                },
                800: {
                    slidesPerView: 3,
                    spaceBetween: 15
                },
                991: {
                    slidesPerView: 3,
                    spaceBetween: 30
                },
                1200: {
                    slidesPerView: 3,
                    spaceBetween: 30
                },
            },
        });
    }


    if (document.getElementById('descText')) {
        new Readmore('#descText', {
            collapsedHeight: 450,
            moreLink: '<div class="seo-text__footer seo-text__footer--shadow"><a href="" class="btn-link btn-link--green">' +
                'Показать полностью <svg width="12" height="6" class="ml-5">\n' +
                '                    <use xlink:href="#svg-bottom"></use>\n' +
                '                </svg></a></div>',
            lessLink: '<div class="seo-text__footer"><a href="" class="btn-link btn-link--green">' +
                'Скрыть <svg width="12" height="6" class="ml-5">\n' +
                '                    <use xlink:href="#svg-up"></use>\n' +
                '                </svg></a></div>',
        });
    }

    if (document.getElementById('seoText')) {
        new Readmore('#seoText', {
            collapsedHeight: 225,
            moreLink: '<div class="seo-text__footer"><a href="" class="btn-link">' +
                'Подробнее <svg width="12" height="6" class="ml-5">\n' +
                '                    <use xlink:href="#svg-bottom"></use>\n' +
                '                </svg></a></div>',
            lessLink: '<div class="seo-text__footer"><a href="" class="btn-link">' +
                'Скрыть <svg width="12" height="6" class="ml-5">\n' +
                '                    <use xlink:href="#svg-up"></use>\n' +
                '                </svg></a></div>',
        });
    }

    function getScrollMenu() {
        let el = document.body;
        if (pageYOffset > 300) {
            el.classList.add('fix_menu');
        } else {
            el.classList.remove("fix_menu");
        }
    }

    getScrollMenu();
    window.addEventListener('scroll', function () {
        getScrollMenu();
    });

    if (document.getElementById('searchBox')) {
        let searchBox = document.getElementById('searchBox');
        let searchHeader = document.getElementById('searchHeader');
        let searchBoxRemove = document.getElementById('searchBoxRemove');
        let searchBg = document.getElementById('searchBg');

        searchBox.addEventListener("mouseover", () => {

            if (searchHeader.value.length > 0) {
                activeSearch();
            }
        });

        searchHeader.addEventListener("click", () => {
            if (!document.body.classList.contains('search_active')) {
                document.body.classList.add('search_active');
            }
        });

        searchBg.addEventListener("click", () => {
            if (document.body.classList.contains('search_active')) {
                document.body.classList.remove('search_active');
            }
        });

        searchBox.addEventListener("mouseout", () => {
            /* if (document.body.classList.contains('search_active')) {
                 document.body.classList.remove('search_active');
             }*/
            let searchBoxResult = document.getElementById('searchBoxResult');
            if (searchBoxResult.classList.contains('active')) {
                searchBoxResult.classList.remove('active');
            }
        });

        searchHeader.addEventListener("input", () => {
            if (searchHeader.value.length > 0) {
                activeSearch();
            } else {
                clearSearch(event);
                /*if (searchBoxResult.classList.contains('active')) {
                    searchBoxResult.classList.remove('active');
                }*/
            }
        });

        searchBoxRemove.addEventListener("click", clearSearch);
    }
    let elemetsMenu = document.querySelectorAll('.catalog-menu__nav li')

    elemetsMenu.forEach((el) => {
        el.addEventListener('mouseover', () => {
            let activeNav = document.querySelector('.catalog-menu__nav li.active');
            if (activeNav) {
                activeNav.classList.remove("active");
            }

            el.classList.add('active');
            let activeIdSubNav = el.dataset.target;

            let removeActiveNav = document.querySelector('.catalog-menu__list__item.active');
            if (removeActiveNav) {
                removeActiveNav.classList.remove("active");
            }

            if (document.getElementById(activeIdSubNav)) {
                document.getElementById(activeIdSubNav).classList.add("active");
            }
        });

    });

    if (document.getElementById('collapseMenu')) {
        const collapseMenu = document.getElementById('collapseMenu');

        const scrollMenu = new SimpleBar(document.getElementById('scrollMenu'), {autoHide: false});
        collapseMenu.addEventListener('hidden.bs.collapse', event => {
            document.body.classList.remove('menu_open');
            document.getElementById('fixNavWrap').style.paddingRight = '0px';
            document.body.style.paddingRight = '0px';
        });
        collapseMenu.addEventListener('show.bs.collapse', event => {
            document.body.classList.add('menu_open');
            document.getElementById('fixNavWrap').style.paddingRight = getScrollBarWidth() + 'px';
            document.body.style.paddingRight = getScrollBarWidth() + 'px';
        });
    }

    const maskPhone = document.querySelectorAll('.js-mask-phone');
    maskPhone.forEach(el => {
        let im = new Inputmask("+7 999 999-99-99", {"clearIncomplete": true});
        im.mask(el);
    });

    const ranges = document.querySelectorAll('.js_range_filter');
    let inpMin = [];
    let inpMax = [];
    ranges.forEach((rangeEl, index) => {
        noUiSlider.create(rangeEl, {
            start: [0, parseInt(rangeEl.dataset.max)],
            step: parseInt(rangeEl.dataset.step),
            connect: true,
            format: wNumb({
                decimals: 0,
                thousand: '',
                //suffix: ' ₽'
            }),
            range: {
                'min': parseInt(rangeEl.dataset.min),
                'max': parseInt(rangeEl.dataset.max)
            }
        });
        inpMin[index] = document.getElementById(rangeEl.dataset.idmin);
        inpMax[index] = document.getElementById(rangeEl.dataset.idmax);

        rangeEl.noUiSlider.on('update', function (values, handle) {
            if (handle == 0) {
                inpMin[index].value = values[handle];
            } else {
                inpMax[index].value = values[handle];
            }
        });

        inpMin[index].addEventListener('change', function () {
            rangeEl.noUiSlider.set([this.value, null]);
        });

        inpMax[index].addEventListener('change', function () {
            rangeEl.noUiSlider.set([null, this.value]);
        });
    });

    if (document.getElementsByClassName("js-more-props").length) {
        const moreProps = document.querySelectorAll('.js-more-props');

        moreProps.forEach(el => {
            el.addEventListener('click', (event) => {
                event.target.parentNode.parentNode.classList.add('show_all');
                event.preventDefault(false);
            });
        });
    }

    if (document.getElementById('navCatMore')) {
        document.getElementById('navCatMore').addEventListener('click', (event) => {
            document.getElementById('navCatFooter').remove();
            document.getElementById('navCat').classList.add('show-link');
            event.preventDefault(false);
        });
    }

    if (widthScreen < 992) {
        if (document.getElementById('filterBox')) {
            let filterBox = new bootstrap.Offcanvas(document.getElementById('filterBox'));
            document.getElementById('filterSubmit').addEventListener('click', () => {
                filterBox.hide();
            });
            document.getElementById('filterReset').addEventListener('click', () => {
                filterBox.hide();
            });
        }

    }


    if (document.getElementById('brandsList')) {
        let containerEl = document.getElementById('brandsList');
        let mixer = mixitup(containerEl);
    }

    function setEqualHeight(elements) {
        var mainDivs = document.getElementsByClassName(elements);
        var maxHeight = 0;
        for (var i = 0; i < mainDivs.length; ++i) {
            if (maxHeight < mainDivs[i].clientHeight) {
                maxHeight = mainDivs[i].clientHeight;
            }
        }
        for (var i = 0; i < mainDivs.length; ++i) {
            mainDivs[i].style.minHeight = maxHeight + "px";
        }
    }

    function activeSlideCompare() {
        let compareSlider = new Swiper('#compareSlider', {

            navigation: {
                nextEl: '#compareNext',
                prevEl: '#comparePrev',
            },
            slidesPerView: 3,
            spaceBetween: 30,
            breakpoints: {
                200: {
                    slidesPerView: 1,
                    spaceBetween: 30,
                    navigation: {
                        nextEl: '#compareSlider .button-next',
                        prevEl: '#compareSlider .button-prev',
                    },
                },
                991: {
                    slidesPerView: 1,
                    spaceBetween: 30,
                    navigation: {
                        nextEl: '#compareNext',
                        prevEl: '#comparePrev',
                    },
                },
                1280: {
                    slidesPerView: 3,
                    spaceBetween: 30,
                    navigation: {
                        nextEl: '#compareNext',
                        prevEl: '#comparePrev',
                    },
                },
            },
            on: {
                init: function () {
                    sinfroCompareRow();
                    fixComareSlider();
                },
                resize: function () {
                    sinfroCompareRow();
                }
            },

        });


            let compareMiniSlider = new Swiper('#compareMiniSlider', {
                slidesPerView: 3,
                spaceBetween: 30,
                navigation: {
                    nextEl: '#compareSliderMiniNext1',
                    prevEl: '#compareSliderMiniPrev1',
                },
                breakpoints: {
                    200: {
                        slidesPerView: 1,
                        spaceBetween: 0,
                    },
                    992: {
                        slidesPerView: 2,
                        spaceBetween: 20,
                    },
                    1280: {
                        slidesPerView: 3,
                        spaceBetween: 30,
                    },
                }
            });

            const swipeAllSliders = (index) => {
                compareSlider.slideToLoop(index);
                compareMiniSlider.slideToLoop(index);
            };

            compareSlider.on('slideChange', () => swipeAllSliders(compareSlider.realIndex));
            compareMiniSlider.on('slideChange', () => swipeAllSliders(compareMiniSlider.realIndex));
        if (widthScreen < 992) {
            let compareSlider2 = new Swiper('#compareSlider2', {

                navigation: {
                    nextEl: '#compareSlider2 .button-next',
                    prevEl: '#compareSlider2 .button-prev',
                },
                slidesPerView: 1,
                spaceBetween: 30,
                initialSlide: 1,
                on: {
                    init: function () {

                    },
                }
            });

            let compareMiniSlider2 = new Swiper('#compareMiniSlider2', {
                slidesPerView: 1,
                spaceBetween: 0,
                initialSlide: 1,
                navigation: {
                    nextEl: '#compareSliderMiniNext2',
                    prevEl: '#compareSliderMiniPrev2',
                },

            });

            const swipeAllSliders2 = (index) => {
                compareSlider2.slideToLoop(index);
                compareMiniSlider2.slideToLoop(index);
            };

            compareSlider2.on('slideChange', () => swipeAllSliders2(compareSlider2.realIndex));
            compareMiniSlider2.on('slideChange', () => swipeAllSliders2(compareMiniSlider2.realIndex));


        }
    }

    function fixComareSlider() {
        let boxProps = document.querySelector('#compareSlider .swiper-slide:nth-child(1) .item-product__compare-list');
        let coords = boxProps.getBoundingClientRect();
        console.log(coords.top);
        console.log(coords.bottom);

        document.addEventListener('scroll', function () {
            console.log(pageYOffset);
            if (pageYOffset > coords.top - 350 && pageYOffset < coords.bottom - 150) {
                document.body.classList.add('fixCompare');
            } else {
                if (document.body.classList.contains('fixCompare')) {
                    document.body.classList.remove('fixCompare');
                }
            }
        });
    }

    function sinfroCompareRow() {
        let rowCompare = [].slice.call(document.querySelectorAll('.js-compare-props li'))
        rowCompare.forEach(function (e) {
            setEqualHeight(e.dataset.sinhro);
        });
    }


    if (document.getElementById('compareSlider')) {
        activeSlideCompare();

        /*compareSlider2.slideTo(1);*/

    }

    Fancybox.bind("[data-fancybox]", {
        // Your custom options
    });

    if(document.getElementById('imgSlider')) {
        new Swiper('#imgSlider', {
            slidesPerView: 3,
            spaceBetween: 30,
            navigation: {
                nextEl: '#imgSliderNext',
                prevEl: '#imgSliderPrev',
            },
            pagination: {
                el: '.img-slider__pagination',
                clickable: true,
            },
            breakpoints: {
                200: {
                    slidesPerView: 1,
                },
                440: {
                    slidesPerView: 2,
                    spaceBetween: 20,
                },
                992: {
                    slidesPerView: 2,
                    spaceBetween: 20,
                },
                1280: {
                    slidesPerView: 3,
                    spaceBetween: 30,
                },
            }

        });
    }

    if (document.getElementById('imageProductSlider')) {
        var swiper = new Swiper("#thumbnailProductSlider", {
            spaceBetween: 20,
            slidesPerView: 4,
            freeMode: true,
            lazy: true,
            watchSlidesProgress: true,
            navigation: {
                nextEl: "#thumbnailNext",
                prevEl: "#thumbnailPrev",
            },
        });
        var swiper2 = new Swiper("#imageProductSlider", {
            spaceBetween: 10,
            lazy: true,
            thumbs: {
                swiper: swiper,
            },
            navigation: {
                nextEl: '#imgNext',
                prevEl: '#imgPrev',
            },
        });
    }

    if(document.getElementById('moreProps')) {
        document.getElementById('moreProps').addEventListener('click', () => {
            new bootstrap.Tab('#propsTab')
            let triggerEl = document.querySelector('#propsTab');
            bootstrap.Tab.getInstance(triggerEl).show();
        });
    }
});


function clearSearch(event) {
    let searchBoxRemove = document.getElementById('searchBoxRemove');
    document.getElementById('searchHeader').value = '';
    if (searchBoxRemove.classList.contains('active')) {
        searchBoxRemove.classList.remove('active');
    }
    event.preventDefault();
}

function activeSearch() {
    let searchBoxResult = document.getElementById('searchBoxResult');
    let searchBoxRemove = document.getElementById('searchBoxRemove');
    searchBoxResult.classList.add('active');
    searchBoxRemove.classList.add('active');
}

function getScrollBarWidth() {
    var inner = document.createElement('p');
    inner.style.width = "100%";
    inner.style.height = "200px";
    var outer = document.createElement('div');
    outer.style.position = "absolute";
    outer.style.top = "0px";
    outer.style.left = "0px";
    outer.style.visibility = "hidden";
    outer.style.width = "200px";
    outer.style.height = "150px";
    outer.style.overflow = "hidden";
    outer.appendChild(inner);
    document.body.appendChild(outer);
    var w1 = inner.offsetWidth;
    outer.style.overflow = 'scroll';
    var w2 = inner.offsetWidth;
    if (w1 == w2) w2 = outer.clientWidth;
    document.body.removeChild(outer);
    return (w1 - w2);
};


